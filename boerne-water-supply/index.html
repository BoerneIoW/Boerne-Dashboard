<!doctype html>
<!-- (c) Copyright protected by Duke University -->
<html class="no-js" lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Boerne Water Dashboard</title>
    <meta name="description" content="Boerne water supply status">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="favicon.png">

    <link rel="manifest" href="site.webmanifest">
    <link rel="apple-touch-icon" href="icon.png">
    <!-- Place favicon.ico in the root directory -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Lato&family=Quicksand:wght@400;600&display=swap" rel=  "stylesheet">
     
    <script  src="https://code.jquery.com/jquery-3.5.0.min.js"  integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ="
    crossorigin="anonymous"></script>
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css" rel="stylesheet" />
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css"
        type="text/css"/>

    <!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
    
    <script src="https://d3js.org/d3.v5.min.js"></script>           
    <script type="text/javascript" src="https://cdn.plot.ly/plotly-latest.min.js" defer></script>
    <!-- <script src = "js/plotly-latest.min.js"></script> -->
    <script src="https://unpkg.com/geojson-vt@3.2.0/geojson-vt.js"></script> <!-- create mapbox vector tiles-->
    <link rel="stylesheet" href="css/main_content.css">

    <style type="text/css">

    </style>
</head>

<body>
<div class = "row header">
    <div class="col-sm-8">    
        <h1 style="padding-left: 1em;">Boerne Water Dashboard</h1> 
        <hr style="background-color: #6c019c; height: 5px; margin-top: 1px;">
    </div>
    <div class="col-sm-2">
        <a href = "https://www.ci.boerne.tx.us//149/Utilities"> <img src="img/boerne_logo.png" style="width: 200px; height: 78px; padding-top: 10px; display: inline-block;"> </a> 
    </div>
    <div class="col-sm-2">
        <a href = "https://internetofwater.org/"> <img src="img/iow_logo.png" style="width: 200px; height: 78px; padding-top: 10px; display: inline-block;"> </a> 
    </div>
</div>

<!-- EXPLANATION TAB #################################################################################################

####################################################################################################################-->
<div class = "row header" style="margin-left: 20px;">
  <p style=" font-size: 14px;"><i><b>Disclaimer:</b> This tool is best viewed in Chrome, Firefox, Microsoft Edge, and Safari.</i></p>
  <p style="font-size: 16px;"><span style="color: rgb(108,1,156); font-size: 18px"><b>Welcome to the Boerne Water Dashboard. </b></span> The purpose of this dashboard is to provide water-related data to users in one easy to navigate website. 
    As part of the efforts by the City of Boerne to increase water sustainability and resilience, this website is meant to assist individuals in their decisions as they pertain to water. Simply put, we believe this will better help residents of 
    Boerne and Kendall County better understand where the water they consume every day comes from and how our water resources across the Lone Star State are connected. These efforts tie into a broader Internet of Water, where data can lead to 
    better management. Join the City of Boerne in expanding these efforts by exploring data below.<br>
  </p>  
  <p style="font-size: 16px;"><span style="color: rgb(108,1,156); font-size: 18px"><b>For a walkthrough of the dashboard,</b></span> please watch this <a href="https://www.youtube.com/watch?v=qurbL8w9JPM" target = "_blank">video</a>.<br>
    <span style="color: rgb(108,1,156); font-size: 18px"><b>To get started,</b></span> select a utility from the map or drop down menu (as this project grows, more utilities will be included). <br>
    <span style="color: rgb(108,1,156); font-size: 18px"><b>Next,</b></span> users can select different tabs on the right to learn more about water supply conditions.<br>
    <span style="color: rgb(108,1,156); font-size: 18px"><b>The help icons</b></span> and text descriptions provide more details to understand each tab.
  </p>
  <p style="font-size: 16px;"><span style="color: rgb(108,1,156); font-size: 18px"><b>Note,</b></span> throughout the dashboard you will find underlined text. These are links that can tranfer you to other websites with more information.<br></p>
  <h3 class = "chartTitles" id="dataUpdateNotice" style="padding-top: 20px; left: 50%;"></h3>
  <br>
  <!-- <img id="utilityHelp" style="position: absolute; height: 22px; right: 5px;" src="img/info_icon.png"> -->
    <form name="selectSystem"> 
        <h4 style="display: inline-block; padding-left: 350px">Select a utility from the drop down menu:</h4>&nbsp;
      <select style="width: 350px;" name="setSystem" id="setSystem" onchange="setSystemThis(this);">
              <option selected = "selected" value="none"> Select a Utility </option>
      </select>  
  </form>
</div>


<!--#######################################################################################################
                                    TAB SET UP
    ######################################################################################################-->
<div class="container">
  <div class="col-sm-5" style="padding:0px">
      <div class= "map-layers-row">   
        <h3 class="chartTitles">Turn Map Layers On and Off</h3>
        <h5 class="chartTitles">Once a layer is chosen, hover over it for more information. For definitions on these layers, scroll to the bottom of the map</h3> 
        <div class="row" style="text-align: center; display: inline;"> 
            <button class = "btn" value = "menuUtility" id = "menuUtility" style= "background-color: #6c019c; color: gold;">Utility</button>
            <button class="btn" value= "menuCounty" id= "menuCounty" >County</button>
            <button class="btn" value= "menuGMA" id= "menuGMA">Groundwater Mgmt Area</button>
            <button class="btn" value="menuBasins" id="menuBasins">River Basin</button>
            <button class="btn" value="menuWatershed" id="menuWatershed">Sub-Basin</button>
            <!--<button class="btn" value= "menuSource" id= "menuSource">Water Source</button>-->
            <button class="btn" value= "menuRivers" id= "menuRivers">Rivers</button>
            <button class="btn" value= "menuStreamGages" id= "menuStreamGages">Stream Gages</button>
            <button class="btn" value= "menuReservoirs" id= "menuReservoirs">Reservoirs</button>
            <button class="btn" value= "menuGroundwater" id= "menuGroundwater">Wells</button>
            <button class="btn" value= "menuPrecipitation" id= "menuPrecipitation">Precipitation Stations</button>
            <button class="btn" value= "menuDrought" id= "menuDrought">Drought</button>
            <button class="btn" value= "menuPCP7DayObsv" id= "menuPCP7DayObsv">Precip 7-day Observ</button>
            <button class="btn" value= "menuPCP7DayNorm" id= "menuPCP7DayNorm">Precip 7-day %Normal</button>
            <button class="btn forecast" value= "menuQPF7day" id= "menuQPF7day">QPF 7-day Forecast</button>
            <button class="btn forecast" value= "menuForecastPCP6" id= "menuForecastPCP6">Precip 6-10 Day Forecast</button>
            <button class="btn forecast" value= "menuForecastTEMP6" id= "menuForecastTEMP6">Temp 6-10 Day Forecast</button>
        </div><!--end top row-->
     <!--ADD DIV TO TURN ON WHEN QPF 7-day forecast selected-->
     <div id="moreForecastInfo" style="text-align: center; color: rgb(108,1,156); display: none;">
        <p>For additional forecasts, please visit the <a href="https://www.wpc.ncep.noaa.gov/#page=ovw" target="_blank">Weather Precipitation Center</a>.</p>
      </div>

    </div><!-- end map layers row-->

    <!--#######################################################################################################
                                    MAP DIV
    ######################################################################################################-->
     <div class="map-layer-row" id = "map-column" style="z-index: 1px;" style="border: thin solid rgb(108,1,156);">
           <div id="map" style="height: 600px; z-index: 10;"> <!--border: thin solid black;"--> 
           <div class="infoMap" id="map_hover_box"><p><strong>Hover over a utility for more information</strong></p></div>
           <div class="legend" id="stream-legend" style="display: none;"></div>    
           <div class="legend" id="drought-legend" style="display: none;"></div>    
         </div> <!--end map Div-->
      </div><!--end map row div-->
      <p> Below are definitions/explenations for the map layers found above</p>
        <ul style="list-style-type:square">                             
          <li> <b>Utility:</b> geographic boundary of the utility</li>
          <li> <b>County:</b> the boundaries of <i>all</i> Texas counties with their names</li>
          <li> <b>Groundwater Mgmt Area:</b> Groundwater Management Areas were created for the protection of groundwater. There are 16 of these GMAs across Texas, 
            and this map layers shows those boundaries. Boerne and Kendall County are located in GMA 9.</li>
          <li> <b>River Basin:</b> a river basin is an area of land where rainfall and other water tributaries, such as creeks, drain into a river and its tributaries. 
            This layer shows the river basins of Texas with their names. Boerne Utilities is within the San Antonio River Basin, while Canyon Lake is 
            within the Guadalupe River Basin.</li>
          <li> <b>Sub-Basin:</b> these sub-basins are found within a major river basin. The San Antonio River Basin has 4 sub-basins (Medina Rive, Upper San Antonio River, 
            Cibolo Creek, and Lower San Antonio River). This layer shows these sub-basins and their names</li>
          <li> <b>Rivers:</b> rivers of Texas</li>
          <li> <b>Stream Gages:</b> a site/location used to monitor a body of water. This layer shows the three sites that are relevant to Boerne (one within the utility 
            boundary and two at Canyon Lake).</li>
          <li> <b>Reservoirs:</b> a man-made lake used as a water supply. For Boerne, the reservoir of relevance is Canyon Lake.</li>
          <li> <b>Wells:</b> groundwater wells are holes drilled into the ground to access groundwater. This layer shows the 42 wells monitored by the Cow Creek Groundwater 
            Conservation District. Groundwater Conservation Districts (GCDs) have the authority to regulate spacing and/or production of wells. Their color indicates their 
            status (from extremely wet to extremely dry) based on their historic data of water level (keeping in mind well depth).</li>
          <li> <b>Precipitation Stations:</b> relevant precipitation stations and their color indicates their status based on historic data of measured precipitation.</li>
          <li> <b>Drought:</b> stages of drought, from None (no drought) to D4 (exceptional drought), throughout the country.</li>
          <li> <b>Precip 7-day Observ:</b> the last 7-day totals of observed rainfall at the state level</li>
          <li> <b>Precip 7-day % Normal:</b> the percent normal for the last seven days of observed rainfall. Percent normal is in reference to the percentage that the observed 
            period is above or below what is “normal.” Normal is defined by averaging past years of precipitation.</li>
          <li> <b>*QPF 7-day Forecast:</b> QPF stands for Quantitative Precipitation Forecasts, and they represent the amount of liquid precipitation expected to fall during a 
            defined period of time, in this case, seven days.</li>
          <li> <b>*Precip 6-10 Day Forecast:</b> percent chance of precipitation being above or below normal in the next 6-10 days.</li>
          <li> <b>*Temp 6-10 Day Forecast:</b> percent chance of temperature being above or below normal in the next 6-10 days.</li>
        </ul>
        <p> * These layers are different in that they are forecasts and not actual observed data points.</p>
  </div> <!--co-sm-5 end Map section-->

     
 <script>//LOAD DROP DOWN LIST
  document.getElementById("setSystem").options.length = 1;
  opts = document.getElementById('setSystem');

  d3.csv("data/basic_info.csv").then(function(dataCSV){
  var systemList = dataCSV.filter(function(d) { return d.data === "yes"; });
  var systemNames = systemList.map(function(d){ return d.utility_name; });
  systemList.sort(function (a,b) {
     return (a.utility_name < b.utilty_name) ? -1 : 1;
  });
  for(i=0; i< systemNames.length; i++) {
         var option = document.createElement('option');
            option.text = systemList[i].utility_name;
            option.value = systemList[i].pwsid;
            opts.appendChild(option);
  }
  opts.value = myUtility;
});//end d3

function setSystemThis(target){
  var sel = document.getElementById('setSystem');
    myUtilityID = sel.value;
    myUtility = sel.options[sel.selectedIndex].text;
    geocoder.clear();

    map.setFilter('water_supply', ['in', 'drawFile', myUtilityID]);
    map.setFilter('water_supply_name', ['in', 'drawFile', myUtilityID]);
    
    if (myUtilityID === "none"){
      myUtility = "none";
      myUtilityInfo(myUtility);
      createBlankSummary();
    }
    if (myUtilityID !== "none"){
      myUtilityInfo(myUtility);
      createCurrentSummary(myUtility);
      createDemandInfo(myUtilityID, checkedDemand);
    }
   
    return {myUtility, myUtilityID};
 }

</script>


<!--#######################################################################################################
                                      Tab Content
  ######################################################################################################-->
<div class = "col-sm-7">
    <div class="row">
    <ul id="tabs" class="nav nav-pills" data-tabs="tabs">
        <li class = "active"><a href="#about" data-toggle="tab">My <br> Utility</a></li>
        <li><a href="#demand" data-toggle="tab">Demand <br> Data</a></li>
        <li><a href="#pop" data-toggle="tab">Population <br> Data</a></li>
        <li><a href="#waterSupplyStatus" data-toggle="tab">Surface <br> Water</a></li>
        <li><a href="#pcpDrought" data-toggle="tab">Rain &<br>Drought</a></li>
        <li><a href="#groundwater" data-toggle="tab">Ground-<br>water</a></li>
        <li><a href="#reclaimed" data-toggle="tab">Reclaimed<br>Water</a></li>
      </ul>
    </div>
  
<div class="row" id="main-one" style="padding: 0 10px;">
   <div id="my-tab-content" class="tab-content clearfix;">
  <!--#######################################################################################################
                                      My Utility Tab
  ######################################################################################################-->
    <div class="tab-pane active" id="about">
      <div class="intro-bkgd">
        <img class="help-icon" id="utilityHelp" src="img/info_icon.png">
          <div class="row" id="utility_tab_info" style="margin: 5px; display: none; z-index: 8;">
              <img src="img/main-page.png" style="width: 100%; display: inline-block;">
          </div>
      
        <h4> <strong>To learn more about your utility please:</strong></h4>
            <ul>
              <li>(1) Select your utility from the map (left) or dropdown menu (above) <em>and</em></li>
              <li>(2) Explore data by adding layers to the map (left) or browsing through the tabs (above). </li>
              <li>(3) You can also enter your address below to find your location within the water service boundary </li>
            </ul>
          <br>
          <!-- place mapbox geocoder here instead of inside the map-->
          <div class = "geocoder" id="geocoder"> </div> <!-- end geocoder div-->
      </div>
      
      <div id="utilityResult">
        <h3 class = "chartTitles">Select a utility</h3>
      </div>
       
      <h4 class="chartTitles" id = "utilityTableHeader"></h4>
      <div id = "utilityTable" class = "table table-wrapper-scroll-y my-custom-scrollbar"></div>
    </div> <!-- end about pane-->
  
  <!--#######################################################################################################
                                      Water Supply Status Tab
      ######################################################################################################-->
    <div class="tab-pane" id="waterSupplyStatus">
      <!--Info Tab-->
       <img class="help-icon" id="surfaceHelp" src="img/info_icon.png">
      <div class="row" id="surface_tab_info" style="margin: 5px; display: none; z-index: 8;">
            <img src="img/surface-tab.png" style="width: 95%; display: inline-block;">
      </div>
      
     <!-- PLOTS -->
      <h4 class = "chartTitles" id = "selectDataName">Select a stream gauge or reservoir to see plot</h4>
      <div class="row" id="selectMetadata" style="text-align: center; color: darkgray">  </div>
      <p>The plot below can show either the streamflow through a stream gauge or the storage of a reservoir. Depending on 
        the site chosen on the map, stream gauge or reservoir, the y-axis of the plot will differ. For <i>stream gauges</i>, the units 
        are in Cubic Feet per Second (cfs). For <i>reservoirs</i> the units are a percentage of full capacity. On the x-axis 
        are the past <i>two</i> years of observed data. The color of each observation represents the status of that observation 
        as it compares to historical data. The “Turn stats layer on” checkbox allows you to dive into statistics/percentiles.</p>
      <div class="row" id = "switchStatsDiv" style= "margin: 10px 20px; display: none;">
        <input type="checkbox" id="switchStats" onclick="toggleStats(this.value)">&nbsp;&nbsp;Turn stats layer on
      </div>
            
      <div class="row chart-row" id = "streamPlot">
        <img class = "chart-holder-icon" src="img/stream_chart_icon.png">
      </div>

            <!-- TABLES -->
      <!--<h4 id = "summaryTitle" class = "chartTitles">Recent Streamflow Conditions for Selected Utility Watersheds</h4> 
      <div class="row chart-row" id="summaryTableDiv"></div>-->

    </div> <!-- end waterSupplyStatus pane-->

    <!--#######################################################################################################
                                      DEMAND Tab
      ######################################################################################################-->
   <div class="tab-pane" id="demand">
      <!--Info Tab-->
       <img class="help-icon" id="demandHelp" src="img/info_icon.png">
      <div class="row" id="demand_tab_info" style="margin: 5px; display: none; z-index: 8;">
            <img src="img/demand-tab.png" style="width: 95%; display: inline-block;">
      </div>
      
      <h4 class="chartTitles" id = "demandTitle">Select a utility to see water demand</h4> 
      <p> The City of Boerne has three main sources of water, of which its contract allocation is the following</p>
      <img src="img/boerne_sources.png" style="width: 810px; height: 510px; padding-top: 10px; display: inline-block;"> </a>
        <!--<ul style="list-style-type:square">                             
          <li> <b>Canyon Lake Reservoir:</b> 1,176.6 million gallons per year</li>
          <li> <b>Groundwater wells from Trinity Aquifers:</b> 325.9 - 602.8 million gallons per year</li>
          <li> <b>Boerne Lake:</b> 271.4 million gallons per year</li>
        </ul>-->
        <p>The bottom two plots show traces of observed demand. The first plot, <i>Daily Demand</i>, shows how much water was consumed 
          each day for each recorded year and is measured in million(s) of gallons per day. The second plot, <i>Cumulative Demand</i>, 
          shows cumulative water consumption day-by-day for a given year and is measured in million(s) of gallons. Both of these plots 
          use the checkboxes to highlight different years.</p>
        <h4 class="chartTitles" id = "demandTitle">Daily Demand</h4>
        
     <!-- PLOTS -->
      <div class="metadata" id="selectDemandMetadata">  </div>
      <div class="row">
        <div class = "col-sm-2" style="padding-top: 20px;">Select to Highlight
        <form style="color: black; font-size: 14px;">
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2002" type="checkbox"> 2002<br>  
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2003" type="checkbox"> 2003<br>
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2004" type="checkbox"> 2004<br>
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2005" type="checkbox"> 2005<br>
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2006" type="checkbox"> 2006<br>
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2007" type="checkbox"> 2007<br>  
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2008" type="checkbox"> 2008<br>
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2009" type="checkbox"> 2009<br>
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2010" type="checkbox"> 2010<br>  
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2011" type="checkbox"> 2011<br>  
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2012" type="checkbox"> 2012<br>  
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2013" type="checkbox"> 2013<br>  
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2014" type="checkbox"> 2014<br>  
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2015" type="checkbox"> 2015<br>
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2016" type="checkbox"> 2016<br>  
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2017" type="checkbox"> 2017<br>  
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2018" type="checkbox"> 2018<br>
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2019" type="checkbox"> 2019<br>
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2020" type="checkbox"> 2020<br>
            <input onclick="createTraceDemand(this.value)" name="checkDemandYear" value="2021" type="checkbox" checked> 2021<br>
        </form>
      </div>
        <div class = "row chart-row">
          <div class = "col-sm-9" id = "demandPlot" style="padding: 0;">
            <img class = "chart-holder-icon" src="img/demand_chart_icon.png">
          </div>
        <h4 class="chartTitles" id = "demandTitle">Cummulative Demand</h4>
        <div class = "col-sm-9" id = "demandCumPlot" style="padding: 0;"></div>
        </div>
    </div>
  </div> <!-- end demand pane-->

<!--#######################################################################################################
                                      POPULATION Tab
######################################################################################################-->
   
   <div class="tab-pane" id="pop">
      <!--Info Tab-->
       <img class="help-icon" id="popHelp" src="img/info_icon.png">
      <div class="row" id="pop_tab_info" style="margin: 5px; display: none; z-index: 8;">
            <img src="img/demand-tab.png" style="width: 95%; display: inline-block;">
      </div>
      
      <h4 class = "chartTitles" id = "longPopTitle"></h5>
      <div class="row chart-row" id = "popPlot"></div>

     <!-- PLOTS -->
      <div class="metadata" id="selectpopMetadata">  </div>
      <div class="row">
        <div class = "col-sm-2" style="padding-top: 20px;">
        
      </div>
        <div class = "row">
          <div class = "col-sm-9" id = "popPlot" style="padding: 0;">
            
          </div>
        </div>

        <div class = "row" style="margin-left: 10px;">
          <p><b>CLB</b> represents the population within a city limit boundary. <b>WSB</b> represents the population serviced by the utility.</p>
          <p>This plot represents the number of people utilizing water from Boerne Utilities in two forms. The solid purple line indicates 
            the City of Boerne population and the dashed blue line shows the total number of water customers.</p>
      </div>
    </div>
  </div> <!-- end population pane-->
  
<!--#######################################################################################################
                                      GROUND WATER Tab
      ######################################################################################################-->
    <div class="tab-pane" id="groundwater">
      <!--Info Tab-->
       <img class="help-icon" id="gwHelp" src="img/info_icon.png">
      <div class="row" id="gw_tab_info" style="margin: 5px; display: none; z-index: 8;">
            <img src="img/gw-tab.png" style="width: 95%; display: inline-block;">
      </div>
      <!-- TABLES -->
      <h4 class="chartTitles" id = "groundwaterTitle">Select a well from the map for more information</h4> 
      <div class="metadata" id="selectGWMetadata">  </div>
      <p>Each of these plots has a top axis depicting the land surface. This is to illustrate the depth of the well at which 
        water is observed (i.e., water level). </p>
     <!-- PLOTS -->

      <div class="row" id = "switchGWStatsDiv" style= "margin-left: 20px; display: none;">
          <br>
          <input type="checkbox" id="switchGWStats" onclick="toggleGWStats(this.value)">&nbsp;&nbsp;Turn stats layer on
      </div>

      <h4 class = "chartTitles" id = "relGWTitle"></h4>
        <p>The x-axis (horizontal line) of this first plot, <i>Groundwater Levels Relative to Historic Levels</i>, includes the past <i>two</i> 
          years of observed data. The color represents the status of that observation (from very dry to very wet) as it compares to historical data. 
          It is important to keep in mind the depth of the well when looking at this information. The “Turn stats layer on” checkbox allows a user to 
          dive into statistics/percentiles. The y-axis (vertical line) is the feet below surface at which the water level is at.</p>
       <div class="row chart-row" id = "gwPlot2">
          <img class="chart-holder-icon" src="img/gw_chart_icon.png">
       </div>

      <h4 class="chartTitles" id="monthlyGWTitle" style= "margin-top: 50px;"></h4> 
      <p>The y-axis (vertical line) of this plot, <i>Monthly Mean Trends</i>, remains the same as above, but the water level is a monthly average 
        and shows how far below the surface water was accessible. This is also an indication of higher, lower or average periods of precipitation 
        or an increase in water consumption. It is normal for levels to drop during the summer. The checkbox allows users to observe monthly trends for any given year.</p>
        <div class = "col-sm-2">Select to Highlight
          <form>  
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2005" type="checkbox"> 2005<br>  
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2006" type="checkbox"> 2006<br>  
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2007" type="checkbox"> 2007<br>  
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2008" type="checkbox"> 2008<br> 
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2009" type="checkbox"> 2009<br>  
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2010" type="checkbox"> 2010<br>  
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2011" type="checkbox"> 2011<br>
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2012" type="checkbox"> 2012<br>
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2013" type="checkbox"> 2013<br>
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2014" type="checkbox"> 2014<br>
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2015" type="checkbox"> 2015<br>
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2016" type="checkbox"> 2016<br>  
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2017" type="checkbox"> 2017<br>  
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2018" type="checkbox"> 2018<br>  
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2019" type="checkbox"> 2019<br>
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2020" type="checkbox"> 2020<br>
            <input onclick="createTraceGW(this.value)" name="checkGWYear" value="2021" type="checkbox" checked> 2021<br>
          </form>
        </div>
          <div class = "row">
            <div class = "col-sm-9" id = "gwPlot4" style="padding: 0;"></div> 
          </div>
      <h4 class = "chartTitles" id = "longGWTitle"></h4>
      <p>The y-axis (vertical line) of this plot, <i>Long-term annual trands</i>, remains the same as above, but the water 
      level is a yearly average.</p>
      <div class="row chart-row" id = "gwPlot3"></div>
    
    </div> <!-- endGroundwater pane-->


<!--#######################################################################################################
                                      PCP - DROUGHT Tab
      ######################################################################################################-->
    <div class="tab-pane" id="pcpDrought">
      <!--Info Tab-->
       <img class="help-icon" id="pcpHelp" src="img/info_icon.png">
       <div class="row" id="pcp_tab_info" style="margin: 5px; display: none; z-index: 8;">
            <img src="img/pcp-tab.png" style="width: 95%; display: inline-block;">
      </div>
      <!-- TABLES -->
      <h4 class = "chartTitles" style="width: 90%">Select a sub-basin to see how drought changes over time</h4> 
      <p>By first selecting a sub-basin from the drop-down menu below, the plot will show historic drought conditions for that watershed 
        and the category of drought (Zero-D4) throughout the years. The bar under the headline <i>Percent of "sub-basin name" basin by status</i> 
        represents the most up to date observations of the percentage of area under observed drought.</p>
          <form name="selectSize" style="margin: 20px 0 5px 20px;"> 
              <span><strong>Select Watershed:  </strong></span> &nbsp;
              <select style="width: 280px;" name="setHUC" id="setHUC" onchange="setHUCThis(this);">
                  <option selected = "selected" value="none"> Select from dropdown </option>
                  <optgroup label = "GUADALUPE RIVER BASIN">
                    <option value="12100201"> Upper Guadalupe </option>
                    <option value="12100202"> Middle Guadalupe </option>
                  </optgroup>
                  <optgroup label = "SAN ANTONIO RIVER BASIN">
                    <option value="12100304"> Cibolo </option>
                  </optgroup>
              </select>  
         </form>
         <br>

      <h4 class = "chartTitles" id = "hucDroughtTitle"><br></h4>
      <div class="row curDBlocksStyle" id = "curDBlocks" style="display: none;">
         <div class="col-sm-2 dstat" id = "dnonediv"></div>
         <div class="col-sm-2 dstat" id = "d0div" style="background-color: #FFFF00;"></div>
         <div class = "col-sm-2 dstat" id = "d1div" style="background-color: #FCD37F;"></div>
         <div class = "col-sm-2 dstat" id = "d2div" style="background-color: #FFAA00;"></div>
         <div class = "col-sm-2 dstat" id = "d3div" style="background-color: #E60000; color: white;"></div>
         <div class = "col-sm-2 dstat" id = "d4div" style="background-color: #730000; color: white;"></div>
      </div>
          <!-- PLOTS -->
      <div class="row chart-row" id = "droughtPlot">
        <img class = "chart-holder-icon" src="img/drought_chart_icon.png" style= "height: 200px; width: 200px;">
      </div>
       <div class = "row" style="margin-left: 10px;">
        <p><br> To learn more about current drought conditions, visit the <a href="https://droughtmonitor.unl.edu/CurrentMap/StateDroughtMonitor.aspx?TX" target="_blank">US Drought Monitor of Texas</a>, or <a href="https://www.ci.boerne.tx.us/1947/Water-Conservation" target="_blank"> Boerne Water Conservation</a>.<br></p>
      </div>

    <!-- ###################################### PCP INFORMATION -->
    <h4 class="chartTitles" id="pcpTitle">Select a precipitation gauge from the map for more information</h4> 
    <p>These two plots show first, <i>Monthly Precipitation</i>, and second <i>Cumulative Precipitation</i>. The <i>Monthly Precipitation</i> plot shows how much rain/precipitation 
      fell each month, in inches, at an observed site. The <i>Cumulative Precipitation</i> plot shows the sum amount of precipitation day-by-day, in inches. The checkboxes can be used to highlight 
      different years.</p>
    <p class = "metadata" id = "pcpMetadata"></p>
     <div class="row">
        <div class = "col-sm-2">Select to Highlight
        <form>
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="1990" type="checkbox"> 1990<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="1991" type="checkbox"> 1991<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="1992" type="checkbox"> 1992<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="1993" type="checkbox"> 1993<br> 
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="1994" type="checkbox"> 1994<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="1995" type="checkbox"> 1995<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="1996" type="checkbox"> 1996<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="1997" type="checkbox"> 1997<br> 
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="1998" type="checkbox"> 1998<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="1999" type="checkbox"> 1999<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2000" type="checkbox"> 2000<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2001" type="checkbox"> 2001<br> 
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2002" type="checkbox"> 2002<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2003" type="checkbox"> 2003<br> 
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2004" type="checkbox"> 2004<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2005" type="checkbox"> 2005<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2006" type="checkbox"> 2005<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2007" type="checkbox"> 2007<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2008" type="checkbox"> 2008<br> 
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2009" type="checkbox"> 2009<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2010" type="checkbox"> 2010<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2011" type="checkbox"> 2011<br>
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2012" type="checkbox"> 2012<br>
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2013" type="checkbox"> 2013<br>
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2014" type="checkbox"> 2014<br>
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2015" type="checkbox"> 2015<br>
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2016" type="checkbox"> 2016<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2017" type="checkbox"> 2017<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2018" type="checkbox"> 2018<br>  
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2019" type="checkbox"> 2019<br>
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2020" type="checkbox"> 2020<br>
          <input onclick="createTracePCP(this.value)" name="checkPCPYear" value="2021" type="checkbox" checked> 2021<br>
        </form>
      </div>
        <div class = "row">
          <div class = "col-sm-9" id = "pcpMonthPlot" style="padding: 0;">
            <img class = "chart-holder-icon" src="img/pcp_chart_icon.png">
          </div>
          <div class = "col-sm-9" id = "pcpCumPlot" ></div>
        </div>
    </div>
  </div> <!-- end PCP And DROUGHT pane-->

<!--#######################################################################################################
                                      RECLAIMED WATER Tab
######################################################################################################-->
   <div class="tab-pane" id="reclaimed">
      <!--Info Tab-->
       <img class="help-icon" id="reclaimedHelp" src="img/info_icon.png">
      <div class="row" id="reclaimed_tab_info" style="margin: 5px; display: none; z-index: 8;">
            <img src="img/demand-tab.png" style="width: 95%; display: inline-block;">
      </div>
      
      <h4 class="chartTitles" id = "reclaimedTitle">Select a utility to see reclaimed water produced</h4> 
      <p>Within the City of Boerne, since 2016 reclaimed water has been a source of water (like Canyon Lake, Boerne Lake, and underground wells), 
      but it is used strictly for outdoor irrigation. Like demand, these plots use the checkboxes to highlight different years. The first plot, 
      <i>Daily Reclaimed Water Produced</i>, shows daily observed reclaimed water used for each recorded year and is measured in million(s) of gallons 
      per day. The second plot, <i>Reclaimed Percent of Total Water</i>, shows the percentage that reclaimed water makes up of the total amount of water 
      used by the city. In other words, the total is the sum of demand plus reclaimed water use. Therefore, this plot represents the percentage of total 
      that is reclaimed.</p>
     <!-- PLOTS -->
      <div class="metadata" id="selectreclaimedMetadata">  </div>
      <div class="row">
        <div class = "col-sm-2" style="padding-top: 20px;">Select to Highlight
        <form style="color: black; font-size: 14px;">
          <input onclick="createTraceReclaimed(this.value)" name="checkReclaimedYear" value="2016" type="checkbox"> 2016<br>  
          <input onclick="createTraceReclaimed(this.value)" name="checkReclaimedYear" value="2017" type="checkbox"> 2017<br>  
          <input onclick="createTraceReclaimed(this.value)" name="checkReclaimedYear" value="2018" type="checkbox"> 2018<br>  
          <input onclick="createTraceReclaimed(this.value)" name="checkReclaimedYear" value="2019" type="checkbox"> 2019<br>
          <input onclick="createTraceReclaimed(this.value)" name="checkReclaimedYear" value="2020" type="checkbox"> 2020<br>
          <input onclick="createTraceReclaimed(this.value)" name="checkReclaimedYear" value="2021" type="checkbox" checked> 2021<br>
        </form>
      </div>
      <div class = "row chart-row">
        <div class = "col-sm-9" id = "reclaimedPlot" style="padding: 0;">
          <img class = "chart-holder-icon" src="img/demand_chart_icon.png">
        </div>
        <div class = "col-sm-9" id = "percentoftotalPlot" style="margin-left: 120px;"></div>
      </div>
    </div>
  </div> <!-- end demand pane-->
     
<!--#######################################################################################################
                                      endTabs
      ######################################################################################################-->
    </div> <!-- end my-tab-content-->
   </div> <!--end row -->
   </div> <!--end col-7-sm -->
</div> <!-- end main container-->  

 <script>
    jQuery(document).ready(function(){
       jQuery('#utilityHelp').on('click', function(event) { jQuery('#utility_tab_info').toggle('show');  });  
       jQuery('#surfaceHelp').on('click', function(event) { jQuery('#surface_tab_info').toggle('show');  });  
       jQuery('#demandHelp').on('click', function(event) { jQuery('#demand_tab_info').toggle('show');  });
       jQuery('#popHelp').on('click', function(event) { jQuery('#pop_tab_info').toggle('show');  });
       jQuery('#pcpHelp').on('click', function(event) { jQuery('#pcp_tab_info').toggle('show');  });  
       jQuery('#gwHelp').on('click', function(event) { jQuery('#gw_tab_info').toggle('show');  });  
       jQuery('#reclaimedHelp').on('click', function(event) { jQuery('#reclaimed_tab_info').toggle('show');  });
    });
  </script>

<!--#######################################################################################################
                                     ADD FOOTER
      ######################################################################################################-->
<footer>
    <h4 style="color: rgb(108,1,156);">Credits</h4>
    <p> This tool is a product of the  <a href="https://internetofwater.org/" target = "_blank">Internet of Water</a> and was developed in partnership with the <a href = "https://www.ci.boerne.tx.us/" target = "_blank"> City of Boerne</a>, Benjamin Eldredge and Margaret Lamar at the <a href="https://cibolo.org/" target="_blank">Cibolo Center for Conservation</a>, and Michael H. Young at the <a href="https://www.beg.utexas.edu/" target="_blank">Bureau of Economic Geology at the University of Texas at Austin</a>. 
      <br>
      This project was partially supported by the <a href="https://cgmf.org/p/home.html" target="_blank">Cynthia and George Mitchell Foundation</a>.
      <br>
      The code used to access and create the files for the dashboard can be found here: <a href="https://github.com/BoerneIoW/Boerne-Dashboard" target = "_blank">Boerne Water Dashboard GitHub Repository</a>
    </p>

<div style="display: flex">
  <section class="left-footer">
        <p style="padding-right: 8px;"> 
          <strong>Data Architect updated by<br>
          Data Architect developed by<br>
          Dashboard developed by<br>
          Duke University</strong>
        <br></p>
    </section>
    <section class="right-footer">
      <p style="padding-left: 8px;"> 
          Vianey Rueda <br>
          Kyle Onda <br>
          Lauren Patterson <br>
          Sophia Bryson <br>
      </p>
  </section>
</div>
</footer> <!--internal footer div-->  


<!--#######################################################################################################
                                    DECLARE GLOBAL VARIABLES
    ######################################################################################################-->
<script>
  // DECLARE GLOBAL VARIABLES
  var myUtility = "none";
  var myUtilityID = "none";
  var myHUC = "none";
  var currentYear = 2022;
  var clickedLayer;
  var streamLegend = document.getElementById('stream-legend');
  var recentDate;
  var streamID = "none";  var gwID = "none"; var pcpID = "none";
  var checked = [currentYear-1]; 
  var checkedDemand= [currentYear-1];
  var checkedReclaimed= [currentYear-1];
  var checkedPop= [currentYear-1];
  var checkedGW= [currentYear-1];
  var fileName;
  var streamPlotType = "off";
  var gwPlotType = "off";

  //configures plotly displays
  var config = {
  displayModeBar: true,
  modeBarButtonsToRemove: ['lasso2d', 'select2d', 'resetscale2d', 'toggleSpikelines', 'hoverCompareCartesian', 'hoverClosestCartesian']
  };

  
  // Create a popup, but don't add it to the map yet.
  var popup = new mapboxgl.Popup({
    closeButton: false,
    closeOnClick: false
  });
 

  mapboxgl.accessToken = 'pk.eyJ1IjoidnJ1ZWRhOTciLCJhIjoiY2t3bWZiOXYxMmJ2YTJ2cHcwcTRlYThvbyJ9.wN7ZXW4T0fI0TFzzSVAOfg';
  var map = new mapboxgl.Map({
    container: 'map', //specify container ID
    style: 'mapbox://styles/mapbox/streets-v11', //specify map style
    center: [-98.49653, 29.80583], //specify the start position; long, lat
    zoom: 9
  });
  map.addControl(new mapboxgl.NavigationControl(), 'top-left');

  var geocoder = new MapboxGeocoder({
    accessToken: mapboxgl.accessToken,
    //limit results to Boerne
    bbox: [-98.878512,29.690694,-98.58712,29.89914],
    mapboxgl: mapboxgl,
    placeholder: "Enter address to find your utility",
    zoom: 11
   });
  document.getElementById('geocoder').appendChild(geocoder.onAdd(map));

//draw initial map... set delay to ensure utilities loaded first
  var utilities;
  function getSystemData() { 
    return $.getJSON("data/boerne_utility.geojson", function(siteData){
           utilities = siteData; 
           setTimeout(drawMap(), 4000);
    });
  }
  getSystemData();
  

  //Get the most recent stream gauge data to show map updates
  d3.csv("data/update_date.csv").then(function(today){
  // $.getJSON("data/streamflow/boerne_stream_gauge_sites.geojson", function(lastData){
        // var lastDate = lastData.features[0].properties.date + "-" + lastData.features[0].properties.endYr;
        //console.log(today);
        var lastDate = today[0].today_date;
        document.getElementById("dataUpdateNotice").innerHTML = "Data Last Updated: " + lastDate;
    });


/*-------------------------------------------------------------------------------------------------------
  ////////////    CREATE GEOCODER FUNCTIONS                                             ///////////
--------------------------------------------------------------------------------------------------------*/
   geocoder.on('result', function(ev) {
    var addressReturn = ev.result.center;

    //loop through utilities to see if contained
    myUtility = "none"; myUtilityID = "none";
    var myUtilityData;

    utilities.features.forEach(function(d){
      if (d3.geoContains(d, addressReturn)) {
        myUtility = d.properties.utility_name;
        myUtilityID = d.properties.pwsid;
        myUtilityData = d.properties.data;
      }
    }); // end forEach
    console.log(myUtility);
    //set dropdown list to whatever is selected
    document.getElementById('setSystem').value = myUtilityID;

    if (myUtilityData === "yes"){
      map.setFilter('water_supply', ['in', 'drawFile', myUtilityID]);
      map.setFilter('water_supply_name', ['in', 'drawFile', myUtilityID]);
      createCurrentSummary(myUtility);
    }

    if (myUtilityData === "no" || myUtility === "none"){
      map.setFilter('water_supply', ['in', 'drawFile', "none"]);
      map.setFilter('water_supply_name', ['in', 'drawFile', "none"]);
    }
    
    myUtilityInfo(myUtility);
    
  }); //end geocoder on





  $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
    target=$(e.target).attr("href");
    var visibility;

  if(target=="#waterSupplyStatus")  { 
    visibility = map.getLayoutProperty('streamgauge-layer', 'visibility');
    if (visibility === "none") {
      document.getElementById('menuStreamGages').click();
    }

    //visibility = map.getLayoutProperty('water_supply', 'visibility');
    //if (visibility === "none") {
      //document.getElementById('menuSource').click();
    //}
    
    visibility = map.getLayoutProperty('reservoirs', 'visibility');
    if (visibility === "none") {
      document.getElementById('menuReservoirs').click();
    }

    //Turn off other layers if they are on
    if (map.getLayoutProperty('groundwater', 'visibility') !== "none"){
      document.getElementById('menuGroundwater').click();
    }
    if (map.getLayoutProperty('precipitation', 'visibility') !== "none"){
      document.getElementById('menuPrecipitation').click();
    }
    if (map.getLayoutProperty('drought', 'visibility') !== "none"){
      document.getElementById('menuDrought').click();
    }
    if (map.getLayoutProperty('gma', 'visibility') !== "none"){
      document.getElementById('menuGMA').click();
    }


  }//end stream gauge tab

  if(target=="#demand"){
    createDemandInfo(myUtilityID, checkedDemand);
    
    //turn off other layers
    if (map.getLayoutProperty('streamgauge-layer', 'visibility') !== "none"){
      document.getElementById('menuStreamGages').click();
    }
    if (map.getLayoutProperty('reservoirs', 'visibility') !== "none"){
      document.getElementById('menuReservoirs').click();
    }
    if (map.getLayoutProperty('groundwater', 'visibility') !== "none"){
      document.getElementById('menuGroundwater').click();
    }
    if (map.getLayoutProperty('precipitation', 'visibility') !== "none"){
      document.getElementById('menuPrecipitation').click();
    }
    if (map.getLayoutProperty('drought', 'visibility') !== "none"){
      document.getElementById('menuDrought').click();
    }
    if (map.getLayoutProperty('gma', 'visibility') !== "none"){
      document.getElementById('menuGMA').click();
    }


  }

  if(target=="#reclaimed"){
    createReclaimedInfo(myUtilityID, checkedReclaimed);  
    
    //turn off other layers
    if (map.getLayoutProperty('streamgauge-layer', 'visibility') !== "none"){
      document.getElementById('menuStreamGages').click();
    }
    if (map.getLayoutProperty('reservoirs', 'visibility') !== "none"){
      document.getElementById('menuReservoirs').click();
    }
    if (map.getLayoutProperty('groundwater', 'visibility') !== "none"){
      document.getElementById('menuGroundwater').click();
    }
    if (map.getLayoutProperty('precipitation', 'visibility') !== "none"){
      document.getElementById('menuPrecipitation').click();
    }
    if (map.getLayoutProperty('gma', 'visibility') !== "none"){
      document.getElementById('menuGMA').click();
    }
  } 

  if(target=="#pop"){
    createPopInfo(myUtilityID, checkedPop);  
    
    //turn off other layers
    if (map.getLayoutProperty('streamgauge-layer', 'visibility') !== "none"){
      document.getElementById('menuStreamGages').click();
    }
    if (map.getLayoutProperty('reservoirs', 'visibility') !== "none"){
      document.getElementById('menuReservoirs').click();
    }
    if (map.getLayoutProperty('groundwater', 'visibility') !== "none"){
      document.getElementById('menuGroundwater').click();
    }
    if (map.getLayoutProperty('precipitation', 'visibility') !== "none"){
      document.getElementById('menuPrecipitation').click();
    }
    if (map.getLayoutProperty('gma', 'visibility') !== "none"){
      document.getElementById('menuGMA').click();
    }
  } 
  

  if(target=="#groundwater"){
    
    visibility = map.getLayoutProperty('groundwater', 'visibility');
    if (visibility === "none") {
      document.getElementById('menuGroundwater').click();
    }
    if (gwID !== "none"){
      createGWTab(gwID, recentDate);
    }

    //turn off other layers
    if (map.getLayoutProperty('streamgauge-layer', 'visibility') !== "none"){
      document.getElementById('menuStreamGages').click();
    }
    if (map.getLayoutProperty('reservoirs', 'visibility') !== "none"){
      document.getElementById('menuReservoirs').click();
    }
    if (map.getLayoutProperty('water_supply', 'visibility') !== "none"){
      document.getElementById('menuSource').click();
    }
    if (map.getLayoutProperty('precipitation', 'visibility') !== "none"){
      document.getElementById('menuPrecipitation').click();
    }
    if (map.getLayoutProperty('drought', 'visibility') !== "none"){
      document.getElementById('menuDrought').click();
    }
    if (map.getLayoutProperty('gma', 'visibility') !== "none"){
      document.getElementById('menuGMA').click();
    }


  }

  if(target=="#pcpDrought"){
    visibility = map.getLayoutProperty('precipitation', 'visibility');
    if (visibility === "none") {
      document.getElementById('menuPrecipitation').click();
    }
    visibility = map.getLayoutProperty('drought', 'visibility');
    if (visibility === "none") {
      document.getElementById('menuDrought').click();
    }

    //turn layers off
    //turn off other layers
    if (map.getLayoutProperty('streamgauge-layer', 'visibility') !== "none"){
      document.getElementById('menuStreamGages').click();
    }
    if (map.getLayoutProperty('reservoirs', 'visibility') !== "none"){
      document.getElementById('menuReservoirs').click();
    }
    if (map.getLayoutProperty('groundwater', 'visibility') !== "none"){
      document.getElementById('menuGroundwater').click();
    }
    if (map.getLayoutProperty('water_supply', 'visibility') !== "none"){
      document.getElementById('menuSource').click();
    }
    if (map.getLayoutProperty('gma', 'visibility') !== "none"){
      document.getElementById('menuGMA').click();
    }
  }
});
</script>
<script type="text/javascript" src="scripts/drawMap.js"></script> <!--needs to be asyn-->
<script type="text/javascript" src="scripts/utility_tab.js"></script>
<script type="text/javascript" src="scripts/map_hover_click.js"></script> <!--needs to be asyn-->
<script type="text/javascript" src="scripts/stream_stats.js" defer></script>
<script type="text/javascript" src="scripts/demandTab.js" defer></script>
<script type="text/javascript" src="scripts/popTab.js" defer></script>  
<script type="text/javascript" src="scripts/groundwaterTab.js" defer></script>
<script type="text/javascript" src="scripts/droughtPlot.js" defer></script>
<script type="text/javascript" src="scripts/precipPlots.js" defer></script>
<script type="text/javascript" src="scripts/reclaimedTab.js" defer></script>

    </body>
</html>



